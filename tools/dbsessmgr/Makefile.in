MCS=@MCS@
MCSFLAGS+= -debug+ -debug:full -nologo
MKINSTALLDIRS=@top_builddir@mkinstalldirs 
DISTFILES=Makefile.in $(DBSESSMGR_SOURCES_IN) dbsessmgr.exe.config

DBSESSMGR_REFERENCES= System.Data
DBSESSMGR_REFS= $(addsuffix .dll, $(addprefix -r:, $(DBSESSMGR_REFERENCES)))

DBSESSMGR_SOURCES_IN= AssemblyInfo.cs.in \
	 dbsessmgr.cs

DBSESSMGR_SOURCES = $(DBSESSMGR_SOURCES_IN:.in=)

EXES=dbsessmgr.exe

INSTALL_FILES=dbsessmgr.exe dbsessmgr.exe.config

LOCAL_BIN_DIR=$(DESTDIR)@prefix@/bin

.PHONY: all install clean uninstall trace

all: $(EXES)

install: $(EXES)
	$(MKINSTALLDIRS) $(LOCAL_BIN_DIR)
	cp $(INSTALL_FILES) $(LOCAL_BIN_DIR)

dbsessmgr.exe: $(DBSESSMGR_SOURCES)
	$(MCS) $(MCSFLAGS) $(DBSESSMGR_REFS) /out:$@ $^

clean:
	rm -f $(EXES) *~ *.pdb

uninstall:
	-test -d $(LOCAL_BIN_DIR) && cd $(LOCAL_BIN_DIR) && rm -f $(INSTALL_FILES)

distdir:
	$(MKINSTALLDIRS) $(distdir)
	cp $(DISTFILES) $(distdir)

