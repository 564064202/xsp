MCS=@MCS@
MCSFLAGS+= -debug+ -debug:full -nologo -lib:../NUnitAsp
MKINSTALLDIRS=@top_builddir@mkinstalldirs 
DISTFILES=Makefile.in \
	 $(DIR_SOURCES) \
	  NUnitAspTest.csproj

# 
NUNITASPTEST_REFERENCES= System.Web \
			 NUnitAsp \
			 NUnit.Framework \
			 System.DirectoryServices

REFS= $(addsuffix .dll, $(addprefix -r:, $(NUNITASPTEST_REFERENCES)))

ASPTESTERDIR_SOURCES = \
	./AspTester/ButtonTest.cs \
	./AspTester/CheckBoxTest.cs \
	./AspTester/DataGridTest.cs \
	./AspTester/DropDownListTest.cs \
	./AspTester/ImageButtonTest.cs \
	./AspTester/LabelTest.cs \
	./AspTester/LinkButtonTest.cs \
	./AspTester/ListBoxTest.cs \
	./AspTester/ListControlTest.cs \
	./AspTester/ListItemCollectionTest.cs \
	./AspTester/RadioButtonTest.cs \
	./AspTester/TextBoxTest.cs \
	./AspTester/UserControlTest.cs \
	./AspTester/ValidationSummaryTest.cs

HTMLTESTERDIR_SOURCES = \
	./HtmlTester/AnchorTest.cs \
	./HtmlTester/HtmlInputCheckBoxTest.cs

DIR_SOURCES = \
	./AssemblyInfo.cs \
	./HttpClientCredentialsTest.cs \
	./HttpClientTest.cs \
	./NUnitAspTestCase.cs \
	./ParserTest.cs \
	./PerformanceTest.cs \
	./SetupTest.cs \
	./WebAssertionTest.cs

NUNITASPTEST_SOURCES = \
	$(DIR_SOURCES) \
	$(ASPTESTERDIR_SOURCES) \
	$(HTMLTESTERDIR_SOURCES)

DLLNAME = NUnitAspTest.dll
LOCAL_LIB_DIR=$(DESTDIR)@prefix@/lib

.PHONY: all install clean uninstall trace

all: $(DLLNAME)

install: $(DLLNAME)
	$(MKINSTALLDIRS) $(LOCAL_LIB_DIR)
	cp $(DLLNAME) $(LOCAL_LIB_DIR)

$(DLLNAME): $(NUNITASPTEST_SOURCES)
	$(MCS) $(MCSFLAGS) $(REFS) -target:library -out:$@ $^

clean:
	rm -f $(DLLNAME) *~ *.pdb

uninstall:
	-test -d $(LOCAL_LIB_DIR) && cd $(LOCAL_LIB_DIR) && rm -f $(DLLNAME)

distdir:
	$(MKINSTALLDIRS) $(distdir)
	$(MKINSTALLDIRS) $(distdir)/AspTester
	$(MKINSTALLDIRS) $(distdir)/HtmlTester
	cp $(DISTFILES) $(distdir)
	cp $(ASPTESTERDIR_SOURCES) $(distdir)/AspTester
	cp $(HTMLTESTERDIR_SOURCES) $(distdir)/HtmlTester

