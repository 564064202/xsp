SUBDIRS = server test doc
NAME_VERSION=@PACKAGE_NAME@-@PACKAGE_VERSION@
DIST_DIR="@abs_top_builddir@/$(NAME_VERSION)"
TARFILE=$(NAME_VERSION).tar.gz
PREFIX=@prefix@
TEST_DIR=$(DESTDIR)$(PREFIX)/share/doc/xsp/test
DISTFILES=README NEWS INSTALL configure mkinstalldirs Makefile.in install-sh

.PHONY: all install clean uninstall dist

all:
	for i in $(SUBDIRS); do	\
		$(MAKE) -C $$i || exit 1; \
	done;

install: all
	for i in $(SUBDIRS); do	\
		$(MAKE) -C $$i install || exit 1; \
	done;
	@echo ""
	@echo "xsp installation succeeded!"
	@echo ""
	@echo "  There are some samples ready to run in: "
	@echo "        $(TEST_DIR)"
	@echo ""
	@echo "  You can try them with the following command: "
	@echo "        mono xsp.exe --root $(TEST_DIR)"
	@echo ""

clean uninstall:
	for i in $(SUBDIRS); do	\
		$(MAKE) -C $$i $@ || exit 1; \
	done;

dist:
	for i in $(SUBDIRS); do	\
		$(MAKE) -C $$i dist DESTDIR=$(DIST_DIR) PREFIX= || exit 1; \
	done;

	cp $(DISTFILES) $(DIST_DIR)
	rm -f $(TARFILE)
	tar -czf $(TARFILE) $(NAME_VERSION)
	rm -rf $(NAME_VERSION)

