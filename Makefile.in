SUBDIRS = server test doc
NAME_VERSION=@PACKAGE_NAME@-@PACKAGE_VERSION@
DIST_DIR="@abs_top_builddir@/$(NAME_VERSION)"
TARFILE=$(NAME_VERSION).tar.gz

.PHONY: all install clean uninstall dist

all:
	for i in $(SUBDIRS); do	\
		$(MAKE) -C $$i || exit 1; \
	done;

install: all
	for i in $(SUBDIRS); do	\
		$(MAKE) -C $$i install || exit 1; \
	done;

clean uninstall:
	for i in $(SUBDIRS); do	\
		$(MAKE) -C $$i $@ || exit 1; \
	done;

dist:
	$(MAKE) install DESTDIR=$(DIST_DIR) PREFIX=
	rm -f $(TARFILE)
	tar -czf $(TARFILE) $(NAME_VERSION)

